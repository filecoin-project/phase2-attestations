# Filecoin Phase2 Attestations

This repo contains the attestation files for participants who participated in Filecoin's trusted-setups (multiparty computations which generate Groth16 parameters for each Filecoin proof). This repo is specific to phase2 of Filecoin's trusted-setups; more info regarding phase1 (i.e. "Powers-of-Tau") can be found [below](#phase1).

## Filecoin's Phase2 Ceremonies

Each Filecoin circuit requires its own phase2 trusted-setup. As new proofs are added (and old proofs are upgraded) to the Filecoin network, new directories will be added to this repo. Each of these directories is named after a Git commit in either [`rust-fil-proofs`](https://github.com/filecoin-project/rust-fil-proofs) or [`filecoin-phase2`](https://github.com/filecoin-project/filecoin-phase2) pointing to a place in Git history where each phase2 trusted-setup took place.

| Trusted-Setup | Ceremony Dates | Circuits | Directory |
| :-----------: | :----------: | :------: | :-------: |
| Mainnet | July - August 2020 | SDR-PoRep <br /> Winning-PoSt <br /> Window-PoSt | [b288702](/b288702) |
| SnapDeals | December 2021 - January 2022 | EmptySectorUpdate <br /> EmptySectorUpdate-Poseidon | [934fe8c](/934fe8c) |

**Note:** two phase2 trusted-setups were run for each circuit in the above table; one for the 32GiB sector-size and another for the 64GiB sector-size.

## Phase2 Validation

Filecoin publishes all files generated during its trusted-setups at: https://trusted-setup.filecoin.io.

Once a circuit's trusted-setup is complete, anyone can verify that the circuit's Groth16 parameters used by the Filecoin network were in fact generated during the attested to trusted-setup. The authenticity of each file can be verified using its published GPG signature and the corresponding participant's signing public-key.

Follow the verification instructions in each trusted-setup directory's README to verify the Groth16 parameters generated by the phase2 ceremony.

## Description of Trusted-Setup Phases

Each Filecoin trusted-setup proceeds in two "phases"; phase1, also called "Powers-of-Tau", and phase2. Both trusted-setup phases are run as a multiparty computation; anyone is able to participate and this contribute to the proof's security. Phase1 is run once and is used for all Filecoin circuits, whereas a phase2 ceremony is run for each circuit. Each time the Filecoin network adds a proof type or upgrades an old proof type, a phase2 ceremony must be run to establish that proof type's security.

### Phase1

Filecoin ran one phase1 trusted-setup; the output of which is used in each circuit's phase2 trusted-setup.

The phase1 code can be found in the [`powersoftau`](https://github.com/arielgabizon/powersoftau) repo. Filecoin's phase1 participant attestation files and verification instructions can be found in the [`perpetualpowersoftau`](https://github.com/arielgabizon/perpetualpowersoftau) repo.

An intermediary step called "phase1.5" is run at the end of the phase1 trusted-setup. This step makes phase1's output usable by phase2. The output of phase1 is the file [`challenge19`](http://trusted-setup.filecoin.io/phase1/challenge_19); phase1.5 consists of running the [`create_lagrange`](https://github.com/filecoin-project/powersoftau/blob/master/src/bin/create_lagrange.rs) binary on `challenge19`. The outputs of phase1.5 are the files `phase1radix2m{0..27}` which are used by phase2 to generate each circuit's Groth16 parameters.

#### Phase1 Randomness Beacon

Filecoin did not use a randomness beacon during its phase1 trusted-setup for the following reason:

> Applying the random beacon, enables proving security of the MPC under the Knowledge of Exponent assumption as shown in
> the [paper of Bowe, Gabizon and Miers](https://eprint.iacr.org/2017/1050.pdf). However, there is no known attack when
> the random beacon is omitted; and in fact, Mary Maller showed (see [A Proof of Security for the Sapling Generation of
> zk-SNARK Parameters in the Generic Group
> Model](https://github.com/zcash/sapling-security-analysis/blob/master/MaryMallerUpdated.pdf) and [Reinforcing the
> Security of the Sapling MPC](https://electriccoin.co/blog/reinforcing-the-security-of-the-sapling-mpc/)) that the MPC
> can be proven secure in the generic group model even when the random beacon is not used. Though the generic group
> model is a stronger assumption than the knowledge of exponent, this is arguably not a big issue in this context, as
> the generic group model is needed in any case for the security of the Groth16 zk-SNARK [â€”Ariel
> Gabizon](https://github.com/arielgabizon/perpetualpowersoftau)

### Phase2

Each circuit's phase2 proceeds as follows:

1. Initial Groth16 parameters are deterministically generated for the circuit using the phase1 file `phase1radix2m<exp>` corresponding to the circuit's size; note that these initial Groth16 parameters are insecure
2. The first participant generates secret randomness and updates the initial parameters using their generated randomness
3. The first participant's contribution is verified using a variety of techniques including file checksum validation, participant signature validation, hash chains, and a probabilistic technique which ensures that all Groth16 parameters were updated using the same randomness (without the verifier learning the participant's randomness)
4. Repeat steps 3 and 4 for each remaining participant; each participant generates secret randomness and mutates the previous participant's parameters
5. The circuit's Groth16 proving and verifying keys are split out of the final participant's phase2 parameters

The code used to run phase2 can be found in the [`filecoin-phase2`](https://github.com/filecoin-project/filecoin-phase2) repo.

#### Files Generated During Phase2

Each participant generates a parameters file, a `.contrib` contribution file, and two `.sig` signature files.

- **Parameters File:** each participant generates a parameters file `<proof>_poseidon_<sector>_<commit>_<num>_<size>` by mutating the previous participant's parameters file using secretly generated randomness.
    - `proof` is the proof/circuit's name (`sdr`, `winning`, `window`, `update`, `updatep`)
    - `poseidon` is Filecoin's TreeR hash function
    - `sector` is the sector-size with which the circuit is compatible (`32gib`, `64gib`)
    - `commit` is a 7-character git commit digest pointing to the phase2 code and circuit
    - `num` is an unsigned integer incremented once for each phase2 participant; each circuit's initial parameters have participant number `0`, likewise the first participant has number `1` and so on
    - `size` indicates the parameters file's size; a `large` parameters file contains all of a circuit's Groth16 parameters, whereas a `small` file contains only the subset of Groth16 parameters updated by the participant

- **Contribution File:** when updating the phase2 parameters, a participant generates a `.contrib` contribution file which stores a checksum of the previous participant's parameters, the current participant's parameters, and data about how the participant mutated the parameters; the `.contrib` files generated during each circuit's trusted-setup function as a hash chain used to verify the trusted-setup.

- **Signature Files:** each participant signs their generated parameters and `.contrib` files using GPG; signing produces two detached signature files having extensions `.sig` and `.contrib.sig`. These signature files ensure that the phase2 files published by Filecoin were in fact created by the attested to participant. Verifying a participant's signatures requires downloading the participant's GPG signing public-key; this repo contains a link to each participant's published public-key.

## Contact Us

A slack channel has been set up to discuss Filecoin's trusted-setup; please join the **#fil-trustedsetup** channel in our Slack workspace `filecoinproject.slack.com` or email us at `trustedsetup@protocol.ai`.
